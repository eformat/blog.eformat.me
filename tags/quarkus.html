<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    
    <title>eformat.me - quarkus</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="eformat.me : quarkus">
    <meta property="og:title" content="eformat.me - quarkus" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://blog.eformat.me/img/eformat.me.jpg" />
    <meta property="og:url" content="https://blog.eformat.me/tags/quarkus.html" />
    <meta property="og:description" content="eformat.me : quarkus" />
    <meta property="og:locale" content="en_GB" />
    <meta property="og:site_name" content="eformat.me" />

    <!-- Le styles -->
    <link href="../css/lightbox.css" rel="stylesheet">
    <link href="../css/yeti/bootstrap.min.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/asciidoctor.css" rel="stylesheet">
    <!-- link href="/css/bootstrap-theme.min.css" rel="stylesheet" -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../favicon.ico">

    <!-- WebAnalytics -->
    <script defer data-domain="blog.eformat.me" src="https://plausible.apps.sno.eformat.me/js/script.js"></script>
  </head>
  <body>
    <div id="wrap">

	
	      <!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-menu">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../index.html">eformat.me</a>
          </div>
          <div class="collapse navbar-collapse" id="navbar-menu">
            <ul class="nav navbar-nav">
              <li><a href="https://github.com/eformat" target="github:eformat">Github</a></li>
              <li><a href="../archive.html">Archives</a></li>
              <li><a href="../feeds/posts/default.xml">Flux RSS</a></li>
              <li><a href="https://plausible.apps.sno.eformat.me/blog.eformat.me" target="eformat:analytics">Analytics</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
      <div class="container">


	<div class="page-header">
            <div class="row">
                <div class="col-xs-4 col-md-2"><img src="../img/eformat.me.jpg"></div>
                <div class="col-xs-12 col-md-8"><h1>Tag: quarkus</h1></div>
            </div>
	</div>

    <div class="row">

    <div class="col-sm-8">
        
            
                <a href="../2023/06/graphql-federation-quarkus.html"><h1>GraphQL Federation with Quarkus</h1></a>
                <p>16 June 2023</p>

                <p>Tags :
                <a href="quarkus.html">quarkus</a>, <a href="graphql.html">graphql</a>, <a href="apollo.html">apollo</a>, <a href="api.html">api</a>, <a href="teams.html">teams</a>
                </p>

                <!--a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.eformat.me/2023/06/graphql-federation-quarkus.html" data-text="GraphQL Federation with Quarkus" data-via="eformat" data-lang="en">Tweeter</a-->
                <!--script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script-->
                <div class="g-plusone" data-size="medium" data-href="http://www.eformat.me/2023/06/graphql-federation-quarkus.html"></div>

                <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A canonical example using Quarkus GraphQL Federation and the Apollo Gateway server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_new_age_of_apis">New Age of API&#8217;s</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For some time now I have been following and using graphql as an API mechanism. If you have not heard of it, there are many <a href="https://www.apollographql.com/docs/intro/benefits">great resources</a> that talk about the benefits. Another <a href="https://graphql.org/learn/">great learning site is here</a>. For me, some obvious benefits of GraphQL include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>eliminates over-fetching of data from an API</p>
</li>
<li>
<p>code a graphql API that can easily change without having to modify all the client code</p>
</li>
<li>
<p>you don&#8217;t end up with hundreds of REST API&#8217;s for every single use case that come up</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In particular though - the composable nature of <strong>Federated</strong> graphql schemas is what catches my eye. Some early adopters like Netflix have blogged
about their engineering efforts in this area.</p>
</div>
<div class="paragraph">
<p>In particular checkout Netflix&#8217;s <a href="https://netflixtechblog.com/how-netflix-content-engineering-makes-a-federated-graph-searchable-5c0c1c7d7eaf"><strong>Studio Search</strong></a>
and <a href="https://netflixtechblog.com/data-movement-in-netflix-studio-via-data-mesh-3fddcceb1059"><strong>DataMesh</strong></a> blogs</p>
</div>
<div id="lightbox"></div>
<div class="imageblock id="netflix-studio-search">
  <img src="/2023/06/netflix-studio-search.png" class="zoom">
</div>
<div class="paragraph">
<p>By using a Federated Graph with graphql, different departments within the company can control and contribute independently the API&#8217;s that compose StudioSearch.</p>
</div>
<div class="paragraph">
<p>For me, this also fits in with a <strong>Team Topology</strong> view of the world - where individual stream aligned business teams can control their bits of the graph, whilst contributing to the whole fairly autonomously.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_issues_of_code">Issues of Code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Graphql was born in a nodejs ecosystem. But of course we ‚ù§ Java, and in particular, Quarkus has a <a href="https://quarkus.io/guides/smallrye-graphql"> smallrye graphqlÔ∏è implementation</a>.</p>
</div>
<div class="paragraph">
<p>There has been a long-running <a href="https://github.com/smallrye/smallrye-graphql/issues/521">RFE</a> for adding GraphQL Federation to Quarkus. I would say in general things are looking pretty good these days with the addition of federation into the underlying <a href="https://smallrye.io/smallrye-graphql/2.2.1/federation/">smallrye implementation</a>.</p>
</div>
<div class="paragraph">
<p>The other day, I was following this <a href="https://github.com/quarkusio/quarkus/issues/30180">bug</a> around resolving entities and was thinking to myself "this should work OK now!!" - so I went ahead and played around with the code. What resulted was a nice simple working
example of graphql federation.</p>
</div>
<div id="lightbox"></div>
<div class="imageblock id="federated-subgraph">
  <img src="/2023/06/federated-subgraph.png" class="zoom">
</div>
<div class="paragraph">
<p>In the picture of Apollo&#8217;s Explorer - the Product{id, name} are sourced from the Product subgraph, and the Product{review} from the Review subgraph.</p>
</div>
<div class="paragraph">
<p>ü§† The <a href="https://github.com/eformat/quarkus-graphql-issue">Source Code is HERE</a> so you can follow along. ü§†</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_example_in_detail">The Example in Detail</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let me explain it a bit more in detail. There are three pieces to the simple architecture - a gateway component (apollo server), and two Quarkus graphql API&#8217;s (Product, Review).</p>
</div>
<div class="paragraph">
<p>You can run the two Quarkus graphql API&#8217;s using maven, and for any one of them, browse to the Quarkus Developer UI by hitting the 'd' key in the terminal. For example:</p>
</div>
<div id="lightbox"></div>
<div class="imageblock id="quarkus-dev-ui">
  <img src="/2023/06/quarkus-dev-ui.png" class="zoom">
</div>
<div class="paragraph">
<p>Use the Smallrye GraphQL panel to browse the individual schema, and to run individual queries using GrapQi against the single API e.g. for the Product api</p>
</div>
<div id="lightbox"></div>
<div class="imageblock id="graphql-productById">
  <img src="/2023/06/graphql-productById.png" class="zoom">
</div>
<div class="paragraph">
<p>we can run ProductByID and see the result for the fields we desire.</p>
</div>
<div class="paragraph">
<p>Now, in the Review service, we use a Federated Entity <a href="https://www.apollographql.com/docs/federation/entities">that you can read about here</a> to extend the Product with a Review.</p>
</div>
<div class="paragraph">
<p>The jey bit of Java code is the annotations that make this happen in the Review module&#8217;s Product domain model class i.e. <code>@Extends</code> and <code>@Key</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Extends
@Key(fields = "id")
public class Product {
    private Review review;
    // getters and setters not shown
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this way, we are extending the Product from the Product API with a Review.</p>
</div>
<div class="paragraph">
<p>We can query the individual graphql schemas in the DevUI or from the command line using curl.</p>
</div>
<div class="paragraph">
<p>Product API</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">$ curl http://localhost:8081/graphql/schema.graphql

union _Entity = Product

type Product @key(fields : "id") {
  id: ID
  name: String
}

"Query root"
type Query {
  _entities(representations: [_Any!]!): [_Entity]!
  _service: _Service!
  "All Products"
  allProducts: [Product]
  "Find product by ID"
  productById(id: String): Product @provides(fields : "id")
}

type _Service {
  sdl: String!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Review API</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">$ curl http://localhost:8082/graphql/schema.graphql

union _Entity = Product | Review

type Product @extends @key(fields : "id") {
  id: ID
  review: Review
}

"Query root"
type Query {
  _entities(representations: [_Any!]!): [_Entity]!
  _service: _Service!
  "Find product by ID"
  productById(id: String): Product
  "Find review by ID"
  reviewById(id: String): Review
}

type Review @key(fields : "id") {
  id: ID
  product: Product
  rating: Int
  text: String
}

type _Service {
  sdl: String!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see that the Product {id review} is provided by the Review API whilst the Product {id name} is provided by the Product API. You can also Query for Reviews and Products independently.</p>
</div>
<div class="paragraph">
<p>I have ommitted all the scalars and directives in the schema output above that are generated by setting these application properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">quarkus.smallrye-graphql.schema-include-scalars=true
quarkus.smallrye-graphql.schema-include-directives=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>These are required by the gateway when it <strong>introspects</strong> the grapql schema to compose the one <strong>Supergraph</strong>.</p>
</div>
<div class="paragraph">
<p>Now to the gateway piece, which is run using apollo nodejs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">gateway$ npm run start

&gt; start
&gt; nodemon gateway.js

[nodemon] 2.0.22
[nodemon] to restart at any time, enter `rs`
[nodemon] watching path(s): *.*
[nodemon] watching extensions: js,mjs,json
[nodemon] starting `node gateway.js`
üöÄ  Server ready at: http://localhost:4000/</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you browse to the apollo endpoint, it will take you to the Sandbox which is very similar to the Quarkus GraphQi interface (the sandbox connects a websocket to your localhost:4000 port eventhough it appears on a cloud hosted url). It shows a nice schema view for the supergraph:</p>
</div>
<div id="lightbox"></div>
<div class="imageblock id="graphql-productById">
  <img src="/2023/06/apollo-fed-schema.png" class="zoom">
</div>
<div class="paragraph">
<p>You can also query this using curl which is harder and a bit uglier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">$ curl -s -X POST http://localhost:4000/graphql -H "Content-Type: application/json" --data-binary '{"query":"{\n\t__schema{\n queryType {\n fields{\n name\n }\n }\n }\n}"}' | jq .
{
  "data": {
    "__schema": {
      "queryType": {
        "fields": [
          {
            "name": "allProducts"
          },
          {
            "name": "productById"
          },
          {
            "name": "reviewById"
          }
        ]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The important bit is this is the federated Supergraph .. so when we query for Product - we can ask for the Product {id name review} fields and the gateway resolves the entities for us, yay !!</p>
</div>
<div class="paragraph">
<p>The one little hack required for the Apollo code to work with Quarkus, it is documented in the README. Apollo does not suppport the newish <code>application/graphql+json</code> Mime Type yet despite PR&#8217;s ;) inclding one from me!</p>
</div>
<div class="paragraph">
<p>Hope you Enjoy! there is a wealth of fun stuff to code with using graphql (go lookup Mutations next!) üëæüëæüëæ</p>
</div>
</div>
</div></p>
                <p><a href="2023/06/graphql-federation-quarkus.html#disqus_thread">Commentaires</a></p>
            

        
            
                <a href="../2023/05/smallrye-stork-load-balancing.html"><h1>Service Discovery and Load Balancing with Stork</h1></a>
                <p>25 May 2023</p>

                <p>Tags :
                <a href="quarkus.html">quarkus</a>, <a href="service discovery.html">service discovery</a>, <a href="stork.html">stork</a>, <a href="load balancing.html">load balancing</a>, <a href="java.html">java</a>
                </p>

                <!--a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.eformat.me/2023/05/smallrye-stork-load-balancing.html" data-text="Service Discovery and Load Balancing with Stork" data-via="eformat" data-lang="en">Tweeter</a-->
                <!--script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script-->
                <div class="g-plusone" data-size="medium" data-href="http://www.eformat.me/2023/05/smallrye-stork-load-balancing.html"></div>

                <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://smallrye.io/smallrye-stork/">Stork</a> is a service discovery and client-side load-balancing framework. Its one of those critical services you
find out you need when doing distributed services programming. Have a read of the docs, it integrates into common open source tooling such as Hashi&#8217;s <a href="https://www.consul.io">Consul</a> as
well as a host of others. Even-though OpenShift/Kubernetes has a built-in support for service discovery and load-balancing, you may need more flexibility to carefully select
the service instance you want.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dns_srv_for_service_discovery">DNS SRV for Service Discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I wanted to try out good 'ol fashioned <a href="https://en.wikipedia.org/wiki/SRV_record">SRV Records</a> as a means to testing out the client side service discovery in Stork. Many people forget that
DNS itself supports service discovery for high service availability. It is still very commonly used, especially in mobile/telco.</p>
</div>
<div class="paragraph">
<p>My test case would be to create a DNS SRV record that queries OpenShift Cluster Canary Application endpoints. I&#8217;m using Route53 for DNS so you can read the
<a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/ResourceRecordTypes.html#SRVFormat">SRV Records format here</a>. The first three records are priority, weight, and port.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">1 10 443 canary-openshift-ingress-canary.apps.sno.eformat.me
1 10 443 canary-openshift-ingress-canary.apps.baz.eformat.me</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you curl one of these, you get a <code>Healthcheck requested</code> back if the service is running.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">curl https://canary-openshift-ingress-canary.apps.sno.eformat.me
Healthcheck requested</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, in my example, you can get a full list of SRV record values by querying:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">dig SRV canary.demo.redhatlabs.dev</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_coding_a_quick_client">Coding a Quick Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For a quick and dirty client to make use of the SRV record I reach out for my favourite tools, yes Perl üê´üê´üê´ !</p>
</div>
<div class="paragraph">
<p>Let&#8217;s query the SRV record and see if my OpenShift clusters are healthy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="perl5"># sudo dnf install -y perl-Net-DNS perl-WWW-Curl
use Net::DNS;
use WWW::Curl::Easy;
use Term::ANSIColor qw(:constants);

sub lookup {
  my ($dc) = @_;
  my $res = Net::DNS::Resolver-&gt; new;
  my $query = $res-&gt;send($dc, "SRV");
  if ($query) {
      foreach $rr ($query-&gt;answer) {
          next unless $rr-&gt;type eq 'SRV';
          # return first found
          return $rr-&gt;target;
      }
  } else {
      print("SRV lookup failed: " . $res-&gt;errorstring);
  }
  return;
}

my $host = lookup("canary.demo.redhatlabs.dev");
print GREEN, $host . "\n", RESET;
my $curl = WWW::Curl::Easy-&gt;new;
$curl-&gt;setopt(CURLOPT_HEADER,1);
$curl-&gt;setopt(CURLOPT_URL, 'https://' . $host);
$curl-&gt;setopt(CURLOPT_SSL_VERIFYHOST, 0);

my $retcode = $curl-&gt;perform;

if ($retcode == 0) {
    print("Transfer went ok\n");
    my $response_code = $curl-&gt;getinfo(CURLINFO_HTTP_CODE);
    print(GREEN, "Received response code: $response_code\n", RESET, "\n");
} else {
    print(RED, "An error happened: $retcode ". RESET . $curl-&gt;strerror($retcode)." ".$curl-&gt;errbuf."\n");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course feel free to run this in a loop :) because each record is equally weighted in the SRV you will get a round-robin behaviour.</p>
</div>
<div id="lightbox"></div>
<div class="imageblock id="perl-srv">
  <img src="/2023/05/perl-srv.png" class="zoom">
</div>
<div class="paragraph">
<p>So, looking good so far.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stork_and_java">Stork and Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Of course, the whole point was to try out Stork. Following the <a href="https://quarkus.io/guides/stork">Quarkus Stork</a> getting started guide, I used a simple rest client service</p>
</div>
<script src="https://gist.github.com/eformat/ef15dcd163d245aa2d6594627482f542.js"></script>
<div class="paragraph">
<p>and configured the <code>canary</code> stork service as follows:</p>
</div>
<script src="https://gist.github.com/eformat/1311409e0e7f1a60ece148a34288f754.js"></script>
<div class="paragraph">
<p>Unfortunately, this didn&#8217;t work as I expected! The SRV record values were <code>resolved</code> to IP addresses instead of returning the DNS name for me to query. The
issue with just an IP address is that Routing in OpenShift requires the HEAD/Location to be set properly so the correct endpoint Route can be routed and queried using HAProxy.</p>
</div>
<div id="lightbox"></div>
<div class="imageblock id="quarkus-stork-call-fail.png">
  <img src="/2023/05/quarkus-stork-call-fail.png" class="zoom">
</div>
<div class="paragraph">
<p>The Stork documentation spells out this DNS resolution process:</p>
</div>
<div id="lightbox"></div>
<div class="imageblock id="stork-query-1">
  <img src="/2023/05/stork-query-1.png" class="zoom">
</div>
<div class="paragraph">
<p>Looking at the source code, led me to submit this <a href="https://github.com/smallrye/smallrye-stork/pull/549/files">PR</a> which adds in an option so that you can skip the DNS resolution step.</p>
</div>
<div class="paragraph">
<p>So, adding this property using the new version of the Stork library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">quarkus.stork.canary.service-discovery.resolve-srv=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Leads to the DNS names being returned and no the ip addresses:</p>
</div>
<div id="lightbox"></div>
<div class="imageblock id="stork-query-2">
  <img src="/2023/05/stork-query-2.png" class="zoom">
</div>
<div class="paragraph">
<p>Trying out the code and now the Service call works as expected:</p>
</div>
<div id="lightbox"></div>
<div class="imageblock id="quarkus-stork-call-ok.png">
  <img src="/2023/05/quarkus-stork-call-ok.png" class="zoom">
</div>
<div class="paragraph">
<p>YAY ! ü¶ç Checkout <a href="https://github.com/eformat/stork-quickstart/tree/main">the source code here</a> and watch out for the next version of Stork !</p>
</div>
</div>
</div></p>
                <p><a href="2023/05/smallrye-stork-load-balancing.html#disqus_thread">Commentaires</a></p>
            

        
            
                <a href="../2022/11/optaplanner-quarkus.html"><h1>AI Constraints Programming with Quarkus and OptaPlanner</h1></a>
                <p>04 November 2022</p>

                <p>Tags :
                <a href="quarkus.html">quarkus</a>, <a href="constraints.html">constraints</a>, <a href="optaplanner.html">optaplanner</a>, <a href="java.html">java</a>
                </p>

                <!--a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.eformat.me/2022/11/optaplanner-quarkus.html" data-text="AI Constraints Programming with Quarkus and OptaPlanner" data-via="eformat" data-lang="en">Tweeter</a-->
                <!--script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script-->
                <div class="g-plusone" data-size="medium" data-href="http://www.eformat.me/2022/11/optaplanner-quarkus.html"></div>

                <p><div class="sect1">
<h2 id="_ai_on_quarkus_i_love_it_when_an_optaplan_comes_together">AI on Quarkus: I love it when an OptaPlan comes together</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I have been meaning to look at <a href="https://www.optaplanner.org/">OptaPlanner</a> for ages. All i can say is <em>"Sorry Geoffrey De Smet, you are a goddamn genius and i should have played with OptaPlanner way sooner".</em></p>
</div>
<div class="paragraph">
<p>So, i watched this video to see how to get started.</p>
</div>
<div class="videoblock">
<div class="content">
<iframe src="https://www.youtube.com/embed/3N3NoDs3Ylc?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="paragraph">
<p>So much fun ! üòÅ to code.</p>
</div>
<div id="lightbox"></div>
<div class="imageblock id="quarkus-school-timetabling-screenshot">
  <img src="/2022/11/quarkus-school-timetabling-screenshot.png" class="zoom">
  <div class="title">Figure - Quarkus School Timetable</div>
</div>
<div class="paragraph">
<p>There were a couple of long learnt lessons i remembered whilst playing with the code.</p>
</div>
<div class="paragraph">
<p>(1) Domain Driven Design</p>
</div>
<div class="paragraph">
<p>To get at the heart of constraints programming you need a good object class hierarchy, one that is driven by your business domain. Thanks Eric Evans for the gift that keeps giving - DDD (and UML) is perfect to help you out here.</p>
</div>
<div id="lightbox"></div>
<div class="imageblock id="ddd-school-timetable-classes">
  <img src="/2022/11/ddd-school-timetable-classes.png" class="zoom">
  <div class="title">Figure - Class Hierarchy</div>
</div>
<div class="paragraph">
<p>You need to have a clean and well thought out class heirarchy so that wiring in OptaPlanner will work for you. I can see several iterations and workshop sessions ensuing to get to a workable and correct understanding of the problem domain.</p>
</div>
<div class="paragraph">
<p>(2) Constraints Programming</p>
</div>
<div class="paragraph">
<p>I went looking for some code i helped write some 15 years ago ! A <a href="https://en.wikipedia.org/wiki/Constraint_programming">Constraint</a> based programming model we had written in C++</p>
</div>
<script src="https://gist.github.com/eformat/87efba0e2ec717ff077852c5924766ec.js"></script>
<div class="paragraph">
<p>We had a whole bunch of Production classes used for calculating different trades types and their values. You added these <em>productions</em> into a solver class heirarcy and if you had the right <a href="https://en.wikipedia.org/wiki/Degrees_of_freedom">degrees of freedom</a> your trade calculation would be successful. The beauty of it was the solver would spit out any parameter you had not specified, as long as it was possible to calculate it based on the production rules.</p>
</div>
<div class="paragraph">
<p>OptaPlanner viscerally reminded me of that code and experience, and started me thinking about how to use it for a similar use case.</p>
</div>
<script src="https://gist.github.com/eformat/6551fe9434bb0a810321c83bd07adee2.js"></script>
<div class="paragraph">
<p>I am now a fan ü•∞</p>
</div>
<div class="paragraph">
<p>One last lesson from the OptaPlanner crew was their use of a a new static doc-generation system, their docs are a thing of beauty i have to say, <a href="https://jbake.org">JBake</a> which I am using to write this blog with. Thanks for all the fish üêü üê† Geoff.</p>
</div>
<div class="paragraph">
<p>OptaPlanner Quickstarts Code - <a href="https://github.com/kiegroup/optaplanner-quickstarts" class="bare">https://github.com/kiegroup/optaplanner-quickstarts</a></p>
</div>
</div>
</div></p>
                <p><a href="2022/11/optaplanner-quarkus.html#disqus_thread">Commentaires</a></p>
            

        

    </div>

    <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
        <div class="sidebar-module sidebar-module-inset">
            <h4>Mike Hepburn</h4>
            <p>This is really working out great.</p>
            <ul>
                <li><a href="https://twitter.com/eformat">@eformat</a></li>
            </ul>
        </div>


        <div class="sidebar-module">
            <h4>Tags</h4>
            <ol class="list-unstyled" style="margin-left: 0px">
                

                <li><a href="openshift.html">openshift</a> (9)</li>
                

                <li><a href="gitops.html">gitops</a> (3)</li>
                

                <li><a href="java.html">java</a> (3)</li>
                

                <li><a href="quarkus.html">quarkus</a> (3)</li>
                

                <li><a href="aiml.html">aiml</a> (2)</li>
                

                <li><a href="argocd.html">argocd</a> (2)</li>
                

                <li><a href="gpu.html">gpu</a> (2)</li>
                

                <li><a href="stable diffusion.html">stable diffusion</a> (2)</li>
                

                <li><a href="acm.html">acm</a> (1)</li>
                

                <li><a href="analytics.html">analytics</a> (1)</li>
                

                <li><a href="api.html">api</a> (1)</li>
                

                <li><a href="apollo.html">apollo</a> (1)</li>
                

                <li><a href="aws.html">aws</a> (1)</li>
                

                <li><a href="bgp.html">bgp</a> (1)</li>
                

                <li><a href="bird.html">bird</a> (1)</li>
                

                <li><a href="constraints.html">constraints</a> (1)</li>
                

                <li><a href="cost.html">cost</a> (1)</li>
                

                <li><a href="devops.html">devops</a> (1)</li>
                

                <li><a href="disconnected.html">disconnected</a> (1)</li>
                

                <li><a href="fediverse.html">fediverse</a> (1)</li>
                

                <li><a href="fedora.html">fedora</a> (1)</li>
                

                <li><a href="flink.html">flink</a> (1)</li>
                

                <li><a href="frr.html">frr</a> (1)</li>
                

                <li><a href="graphql.html">graphql</a> (1)</li>
                

                <li><a href="load balancing.html">load balancing</a> (1)</li>
                

                <li><a href="mastodon.html">mastodon</a> (1)</li>
                

                <li><a href="metallb.html">metallb</a> (1)</li>
                

                <li><a href="optaplanner.html">optaplanner</a> (1)</li>
                

                <li><a href="patterns.html">patterns</a> (1)</li>
                

                <li><a href="platform.html">platform</a> (1)</li>
                

                <li><a href="platform as product.html">platform as product</a> (1)</li>
                

                <li><a href="plausible.html">plausible</a> (1)</li>
                

                <li><a href="pulsar.html">pulsar</a> (1)</li>
                

                <li><a href="registries.html">registries</a> (1)</li>
                

                <li><a href="security.html">security</a> (1)</li>
                

                <li><a href="service discovery.html">service discovery</a> (1)</li>
                

                <li><a href="sno.html">sno</a> (1)</li>
                

                <li><a href="social.html">social</a> (1)</li>
                

                <li><a href="stork.html">stork</a> (1)</li>
                

                <li><a href="streaming.html">streaming</a> (1)</li>
                

                <li><a href="teams.html">teams</a> (1)</li>
                

                <li><a href="vault.html">vault</a> (1)</li>
                

                <li><a href="web.html">web</a> (1)</li>
                
            </ol>
        </div>
    </div>

    </div>

		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
        <p class="text-muted credit">Blog posts are published under Creative Commons license by-nc-sa <em>Creative Commons by-nc-sa</em>. <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a></p>
        <p class="text-muted credit">&copy; 2023 | Baked with <a href="http://jbake.org">JBake v2.7.0-rc.6</a><a href="https://github.com/eformat/blog.eformat.me/actions"> | Published Fri Jun 16 06:09:10 UTC 2023</a></p>
      </div>
    </div>
    
    <!-- Javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/lightbox.js"></script>

    <!--script type="text/javascript">
        window.___gcfg = {lang: 'en'};

        (function() {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = 'https://apis.google.com/js/platform.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
    </script-->

    <!--script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-', '');
      ga('send', 'pageview');

    </script-->
    
  </body>
</html>

